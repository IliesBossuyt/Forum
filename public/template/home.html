<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/home.css">
    <title>Forum</title>
</head>
<body>
    <h2>Bienvenue sur le Forum</h2>

    <form action="/user/create-post" method="POST" enctype="multipart/form-data">
        <textarea name="content" placeholder="Écrivez votre message..."></textarea><br>
        <input type="file" name="image" accept=".jpg, .jpeg, .png, .gif"><br>
        <button type="submit">Publier</button>
    </form>

    <h3>Publications récentes</h3>
    {{range .}}
        <div id="post-{{.Post.ID}}" style="border: 1px solid #ccc; padding: 10px; margin-bottom: 15px;">
            <p><strong>Posté par :</strong> {{.Post.Username}}</p>
            <p id="content-{{.Post.ID}}">{{.Post.Content}}</p>
            {{if .Post.Image}}
                <img src="/entry/image/{{.Post.ID}}" alt="Image postée" width="200" style="cursor: pointer;" onclick="openModal('/entry/image/{{.Post.ID}}')">
            {{end}}

            <p>👍 <span id="likes-{{.Post.ID}}">{{.Post.Likes}}</span> | 👎 <span id="dislikes-{{.Post.ID}}">{{.Post.Dislikes}}</span></p>
            <button onclick="likePost('{{.Post.ID}}', 1)">👍 Like</button>
            <button onclick="likePost('{{.Post.ID}}', -1)">👎 Dislike</button>
            <button onclick="reportPost('{{.Post.ID}}')">🚩 Signaler</button>

            {{if eq .Post.UserID .Post.CurrentUserID}}
                <button onclick="editPost('{{.Post.ID}}')">✏ Modifier</button>
            {{end}}

            {{if or (eq .Post.UserID .Post.CurrentUserID) (eq .Post.CurrentUserRole "admin")}}
                <button onclick="openDeleteForm('{{.Post.ID}}')">🗑 Supprimer</button>
            {{end}}

            <!-- Commentaires -->
            <div style="margin-top: 10px;">
                <h4>Commentaires :</h4>
                {{if .Comments}}
                    {{range .Comments}}
                        <div class="comment">
                            <strong>{{.Username}}</strong> : {{.Content}}<br>
                            <small>{{.CreatedAt}}</small>
                        </div>
                    {{end}}
                {{else}}
                    <p>Aucun commentaire.</p>
                {{end}}

                <!-- Formulaire d'ajout de commentaire -->
                <form action="/user/add-comment" method="POST">
                    <input type="hidden" name="post_id" value="{{.Post.ID}}">
                    <textarea name="content" rows="2" style="width: 100%;" required></textarea><br>
                    <button type="submit">Commenter</button>
                </form>
            </div>
        </div>
    {{end}}
</body>
</html>
